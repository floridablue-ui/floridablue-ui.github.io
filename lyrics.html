<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>해활천공 (海闊天空) - Beyond</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
            color: #e0e0e0;
        }
        
        .main-container {
             text-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }

        .chinese-lyric {
            font-family: 'Noto Sans SC', sans-serif;
            cursor: pointer;
            transition: color 0.3s ease;
            outline: none; /* Remove default focus outline */
        }
        
        .chinese-lyric:hover, .chinese-lyric:focus-visible {
            color: #93c5fd; /* Light blue on hover/focus */
        }

        .korean-translation {
            display: none;
            color: #a5b4fc; /* Indigo-200 for better contrast */
            padding-left: 1rem;
            margin-top: 0.5rem;
            border-left: 2px solid #6366f1; /* Indigo-500 */
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .lyric-block.active .korean-translation {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .title-kr {
             font-family: 'Noto Sans KR', sans-serif;
        }
        
        .dict-word {
            text-decoration: underline;
            text-decoration-color: rgba(147, 197, 253, 0.4);
            text-decoration-style: dotted;
            cursor: help;
            transition: color 0.3s, text-decoration-color 0.3s;
            outline: none; /* Remove default focus outline */
        }
        
        .dict-word:hover, .dict-word:focus-visible {
             color: #facc15; /* yellow-400 */
             text-decoration-color: #facc15;
        }

        #word-popup {
            position: fixed; /* Use fixed positioning for viewport-relative placement */
            display: none;
            background-color: rgba(41, 37, 78, 0.95);
            backdrop-filter: blur(5px);
            border: 1px solid #6366f1;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            font-size: 0.9rem;
            z-index: 100;
            transition: opacity 0.2s, transform 0.2s;
            pointer-events: none;
            max-width: 300px;
        }
        #word-popup .pinyin {
            color: #a5b4fc;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="main-container w-full max-w-2xl bg-black/30 backdrop-blur-md rounded-2xl shadow-2xl p-6 md:p-10 border border-white/10">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-300 chinese-lyric">海闊天空</h1>
            <p class="text-xl md:text-2xl text-blue-400 title-kr">(해활천공)</p>
            <p class="text-lg text-gray-300 mt-2">Beyond</p>
        </div>

        <div id="lyrics-container" class="space-y-4 text-lg md:text-xl">
            <!-- Lyrics will be inserted here by JavaScript -->
        </div>

        <div class="text-center mt-8 text-sm text-gray-400">
            <p>중국어 가사를 클릭하거나 선택 후 Enter를 누르세요.</p>
            <p>밑줄 친 단어를 클릭하면 뜻을 볼 수 있습니다.</p>
        </div>
    </div>

    <!-- Popup for word definitions -->
    <div id="word-popup">
        <strong id="popup-word"></strong>
        <span id="popup-pinyin" class="pinyin"></span><br>
        <span id="popup-meaning"></span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA ---
            const dictionary = {
                "今天": { pinyin: "jīn tiān", meaning: "오늘" },
                "寒夜": { pinyin: "hán yè", meaning: "추운 밤" },
                "看雪": { pinyin: "kàn xuě", meaning: "눈을 보다" },
                "飄過": { pinyin: "piāo guò", meaning: "흩날려 지나가다" },
                "懷著": { pinyin: "huái zhe", meaning: "품고서" },
                "冷卻": { pinyin: "lěng què", meaning: "식다, 냉각되다" },
                "心窩": { pinyin: "xīn wō", meaning: "마음, 가슴" },
                "遠方": { pinyin: "yuǎn fāng", meaning: "먼 곳" },
                "風雨": { pinyin: "fēng yǔ", meaning: "비바람" },
                "追趕": { pinyin: "zhuī gǎn", meaning: "뒤쫓다" },
                "理想": { pinyin: "lǐ xiǎng", meaning: "이상" },
                "自由": { pinyin: "zì yóu", meaning: "자유" },
                "原諒": { pinyin: "yuán liàng", meaning: "용서하다" },
                "跌倒": { pinyin: "diē dǎo", meaning: "넘어지다" },
                "放縱": { pinyin: "fàng zòng", meaning: "방종하다, 제멋대로 하다" },
                "不羈": { pinyin: "bù jī", meaning: "얽매이지 않다" },
                "嘲笑": { pinyin: "cháo xiào", meaning: "비웃다" },
                "冷眼": { pinyin: "lěng yǎn", meaning: "냉담한 눈초리" }
            };

            const lyricsText = `今天我 寒夜裡看雪飄過
오늘 나는 차가운 밤에 눈이 흩날리는 것을 보네
懷著冷卻了的心窩漂遠方
식어버린 마음을 품고 멀리 떠나가네
風雨裏追趕
비바람 속에서 쫓아가지만
霧裡分不清影蹤
안개 속에서 그 자취를 분간할 수 없네
天空海闊你與我
하늘은 넓고 바다는 끝없는데 너와 나는
可會變 (誰沒在變)
변할 수 있을까 (누군들 변하지 않겠는가)
多少次 迎著冷眼與嘲笑
수없이 차가운 눈초리와 비웃음을 마주했지만
從沒有放棄過心中的理想
마음속 이상을 포기한 적 없었네
原諒我這一生不羈放縱愛自由
내 평생 구속 없이 자유를 사랑한 것을 용서해주오
也會怕有一天會跌倒
언젠가 넘어질까 두렵기도 하지만
背棄了理想 誰人都可以
이상을 저버리는 건 누구라도 할 수 있지만
那會怕有一天只你共我
언젠가 너와 나 둘만 남게 될까 두렵지 않아
仍然自由自我
여전히 자유로운 나
永遠高唱我歌走遍千里
영원히 내 노래를 부르며 천 리 길을 가리라`;

            // --- ELEMENTS ---
            const container = document.getElementById('lyrics-container');
            const popupEl = document.getElementById('word-popup');

            // --- FUNCTIONS ---
            
            // Utility to escape special regex characters
            const escapeRegExp = (string) => {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            };

            const createLyricBlocks = () => {
                const lines = lyricsText.trim().split('\n');
                const dictKeys = Object.keys(dictionary).sort((a, b) => b.length - a.length);

                for (let i = 0; i < lines.length; i += 2) {
                    if (!lines[i] || !lines[i+1]) continue;

                    const lyricBlock = document.createElement('div');
                    lyricBlock.className = 'lyric-block py-2';

                    const chineseLine = document.createElement('p');
                    chineseLine.className = 'chinese-lyric text-gray-200';
                    chineseLine.tabIndex = 0; // For accessibility
                    chineseLine.setAttribute('role', 'button');

                    let processedHTML = lines[i];
                    dictKeys.forEach(key => {
                        const regex = new RegExp(escapeRegExp(key), "g");
                        processedHTML = processedHTML.replace(regex, `<span class="dict-word" data-word="${key}" tabindex="0" role="button">${key}</span>`);
                    });
                    chineseLine.innerHTML = processedHTML;

                    const koreanLine = document.createElement('p');
                    koreanLine.className = 'korean-translation';
                    koreanLine.textContent = lines[i+1];
                    
                    lyricBlock.appendChild(chineseLine);
                    lyricBlock.appendChild(koreanLine);
                    container.appendChild(lyricBlock);
                }
            };
            
            const showPopup = (word, def, x, y) => {
                popupEl.querySelector('#popup-word').textContent = word;
                popupEl.querySelector('#popup-pinyin').textContent = `[${def.pinyin}]`;
                popupEl.querySelector('#popup-meaning').textContent = def.meaning;

                popupEl.style.display = 'block';
                
                // Adjust position to stay within the viewport
                const popupRect = popupEl.getBoundingClientRect();
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;

                let top = y + 20;
                let left = x;

                // If popup goes off the bottom, show it above the cursor
                if (top + popupRect.height > viewportHeight) {
                    top = y - popupRect.height - 10;
                }
                
                // If popup goes off the right, align its right edge with the cursor
                if (left + popupRect.width > viewportWidth) {
                    left = viewportWidth - popupRect.width - 10;
                }
                
                // If popup goes off the left, align its left edge
                if (left < 0) {
                   left = 10;
                }

                popupEl.style.left = `${left}px`;
                popupEl.style.top = `${top}px`;
                popupEl.style.opacity = '1';
                popupEl.style.transform = 'scale(1)';
            };

            const hidePopup = () => {
                popupEl.style.opacity = '0';
                popupEl.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    if (popupEl.style.opacity === '0') popupEl.style.display = 'none';
                }, 200);
            };

            // --- EVENT HANDLING ---
            const handleInteraction = (e) => {
                const isKeyEvent = e.type === 'keydown';
                if (isKeyEvent && e.key !== 'Enter' && e.key !== ' ') return;
                
                e.preventDefault();
                const target = e.target;

                // Handle word click/keypress
                if (target.classList.contains('dict-word')) {
                    const lyricBlock = target.closest('.lyric-block');
                    if (!lyricBlock.classList.contains('active')) {
                        document.querySelectorAll('.lyric-block.active').forEach(b => b.classList.remove('active'));
                        lyricBlock.classList.add('active');
                    }
                    const word = target.dataset.word;
                    const definition = dictionary[word];
                    
                    const rect = target.getBoundingClientRect();
                    showPopup(word, definition, rect.left, rect.bottom);
                    return;
                }

                // Handle line click/keypress
                const lyricLine = target.closest('.chinese-lyric');
                if (lyricLine) {
                    const lyricBlock = lyricLine.closest('.lyric-block');
                    const isActive = lyricBlock.classList.contains('active');
                    document.querySelectorAll('.lyric-block.active').forEach(b => b.classList.remove('active'));
                    if (!isActive) lyricBlock.classList.add('active');
                    hidePopup();
                }
            };
            
            // Main event listener using delegation
            container.addEventListener('click', handleInteraction);
            container.addEventListener('keydown', handleInteraction);

            // Hide popup on outside actions
            document.addEventListener('click', (e) => {
                if (!container.contains(e.target)) hidePopup();
            });
            window.addEventListener('scroll', hidePopup, true); // Use capture to catch scroll early
            window.addEventListener('resize', hidePopup);

            // --- INITIALIZATION ---
            createLyricBlocks();
        });
    </script>
</body>
</html>
